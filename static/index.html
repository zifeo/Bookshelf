<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Bookshelf</title>
    <script src="jquery.js"></script>
    <script src="semantic.js"></script>
    <script src="tablesort.js"></script>
    <link rel="stylesheet" type="text/css" class="ui" href="semantic.css">
    <script>
        $(function() {

            $('#results, #details').hide();

            $('.ui.search').search({
                apiSettings: {
                    url: 'search/{query}'
                },
                type: 'category',
                searchFields: [
                    'title'
                ],
                minCharacters: 3,
                onSelect: function(result) {

                    $('#results, #details').hide();
                    $('#presets').dropdown('clear');
                    $('#presets .text').html('Presets');

                    $('#details').show();
                    $('.prompt', this).val(result.title);
                    $('.ui.search').search('hide results');
                    $('.ui.search').addClass('loading');

                    $.getJSON(result.url, function(content) {
                        $('#details').show();
                        $('.ui.search').removeClass('loading');

                        var details = '';
                        $.each(content, function(k, v) {
                            console.log(k);
                            const key = k.split(/(?=[A-Z])/).map(function(e) {
                                return e.toLowerCase();
                            }).join(' ');
                            details += '<div class="item"><div class="content"><div class="header">' + key.charAt(0).toUpperCase() + key.slice(1) + '</div>' + v + '</div></div>';
                        });
                        $('#details').html(details);

                    });
                    return false;
                }
            });

            $('.ui.dropdown').dropdown({ on: 'hover' });

            $(document).on('click', '#go-new-title', function() {
                $('#new-title').modal('show');
            });

            $(document).on('click', '#presets .item[rel]', function() {

                $('#results, #details').hide();
                $('.ui.search .prompt').val('');
                $('#presets').addClass('loading');

                $.getJSON('presets/' + $(this).attr('rel'), function(res) {

                    $('#results thead tr').empty();
                    $('#results tbody').empty();

                    res.headers.forEach(function(e) {
                        $('#results thead tr').append("<th>" + e.charAt(0).toUpperCase() + e.slice(1) + "</th>")
                    });

                    res.rows.forEach(function(e) {
                        var row = "<tr>";
                        e.forEach(function(r) {
                            row += "<td>" + r + "</td>";
                        });
                        $('#results tbody').append(row + "</tr>");
                    });

                    $('#presets').removeClass('loading');
                    $('#results').show();
                    $('.table').tablesort();
                });
            });
            				
			$('#send-title').api({
			    url: 'titles',
			    method : 'GET',
			    serializeForm: true,
			    onSuccess: function(data) {
				    console.log(data);
				    $('#send-title').removeClass('red');
				    $('.ui.form').form('clear');
				    $('#new-title').modal('hide');
			    },
			    onError: function(err) {
				    $('#send-title').addClass('red');
			    }
			});

        });
    </script>
    <style>
        body {
            padding-top: 50px;
        }
    </style>
</head>
<body>
	
<div class="ui fixed menu">
    <div class="ui container">
        <a class="header item" href="">
            BOOKSHELF
        </a>
        <div class="ui search item">
            <div class="ui transparent icon input">
                <input class="prompt" type="text" placeholder="Search animals...">
                <i class="search link icon"></i>
            </div>
        </div>
        <div class="ui dropdown link item" id="presets">
            <span class="text">Presets</span>
            <i class="dropdown icon"></i>
            <div class="menu">
                <div class="header">Deliverable 2</div>
                <div class="item" rel="1">For every year, the year and the number of publications for said year</div>
                <div class="item" rel="2">Names of the ten authors with most publications</div>
                <div class="item" rel="3">Names of the youngest and oldest authors to publish something in 2010</div>
                <div class="item">
                    <i class="dropdown icon"></i>
                    <span class="text">Count of many comics (graphic titles) that have publications with</span>
                    <div class="menu">
                        <div class="item" rel="4">less than 50 pages</div>
                        <div class="item" rel="5">less than 100 pages</div>
                        <div class="item" rel="6">more (or equal) than 100 pages</div>
                    </div>
                </div>
                <div class="item" rel="7">For every publisher, the average price of its published novels (the ones that have a dollar price)</div>
                <div class="item" rel="8">Name of the author with the highest number of titles that are tagged as “science fiction”</div>
                <div class="item" rel="9">Three most popular titles (i.e., the ones with the most awards and reviews)</div>
                <!--<div class="divider"></div>
                <div class="header">Deliverable 3</div>
                <div class="item">The average price per currency of the publications of the most popular title (i.e, the title with most publications overall)</div>
                <div class="item">The names of the top ten title series with most awards</div>
                <div class="item">The name of the author who has received the most awards after his/her death</div>
                <div class="item">For a given year, the three publishers that published the most publications</div>
                <div class="item">Given an author, his/her most reviewed title(s)</div>
                <div class="item">For every language, the top three title types with most translations</div>
                <div class="item">For each year, the average number of authors per publisher</div>
                <div class="item">The publication series with most titles that have been given awards of “World Fantasy Award” type</div>
                <div class="item">For every award category, the names of the three most awarded authors</div>
                <div class="item">The names of all living authors that have published at least one anthology from youngest to oldest</div>
                <div class="item">The average number of publications per publication series (single result/number expected)</div>
                <div class="item">The author who has reviewed the most titles</div>
                <div class="item">For every language, the three authors with the most translated titles of “novel” type</div>
                <div class="item">The top ten authors whose publications have the largest pages per dollar ratio (considering all publications of an author that have a dollar price)</div>
                <div class="item">For publications that have been awarded the Nebula award, the top 10 with the most extensive web presence<br> (i.e, the highest number of author websites, publication websites, publisher websites, publication series websites, and title series websites in total)</div>-->
            </div>
        </div>
        <div class="ui dropdown link item">
            <span class="text">New</span>
            <i class="dropdown icon"></i>
            <div class="menu">
                <div class="item" id="go-new-title">Title</div>
            </div>
        </div>
    </div>
</div>

<div class="ui container">
    <table class="ui selectable sortable celled table" id="results">
        <thead>
        <tr>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div class="ui list" id="details">
    </div>
</div>

<div class="ui modal" id="new-title">
    <i class="close icon"></i>
    <div class="header">
        Save a new title
    </div>
    <div class="content">
        <form class="ui form">
            <div class="field">
                <label>Title</label>
                <input type="text" name="title">
            </div>
            <div class="field">
                <label>Synopsis</label>
                <textarea rows="2" name="synopsis"></textarea>
            </div>
            <div class="field">
                <label>Note</label>
                <textarea rows="2" name="noteId"></textarea>
            </div>
            <div class="field">
                <label>Series</label>
                <select class="ui dropdown series" name="seriesId">
                    <option value="">Select serie</option>
                    <option value="AD">Andorra</option>
                </select>
            </div>
            <div class="field">
                <label>Series number</label>
                <input type="text" name="seriesNum">
            </div>
            <div class="field">
                <label>Story length</label>
                <select class="ui dropdown story-length" name="storyLength">
                    <option value="">Select length</option>
                    <option value="novella">novella</option>
                    <option value="shortstory">shortstory</option>
                    <option value="juvenile_fiction">juvenile_fiction</option>
                    <option value="novelization">novelization</option>
                    <option value="short_fiction">short_fiction</option>
                </select>
            </div>
            <div class="field">
                <label>Type</label>
                <select class="ui dropdown type" name="type">
                    <option value="">Select type</option>
                    <option value="AD">Andorra</option>
                </select>
            </div>
            <div class="field">
                <label>Parent</label>
                <select class="ui dropdown parent" name="parent">
                    <option value="">Select parent</option>
                    <option value="AD">Andorra</option>
                </select>
            </div>
            <div class="field">
                <label>Language</label>
                <select class="ui dropdown languages" name="languageId">
                    <option value="">Select language</option>
                    <option value="AD">Andorra</option>
                </select>
            </div>
            <div class="field">
                <div class="ui toggle checkbox">
                    <input type="checkbox" name="graphic">
                    <label>Graphic</label>
                </div>
            </div>
            <div class="field">
                <label>Review</label>
                <select class="ui dropdown reviews" name="review">
                    <option value="">Select reviewee</option>
                    <option value="AD">Andorra</option>
                </select>
            </div>
            <div class="field">
                <label>Tags</label>
                <select multiple="" class="ui dropdown tags" name="tags">
                    <option value="">Select tags</option>
                    <option value="AF">Afghanistan</option>
                    <option value="AX">Åland Islands</option>
                    <option value="AL">Albania</option>
                </select>
            </div>
            <div class="field">
                <label>Awards</label>
                <select multiple="" class="ui dropdown awards" name="awards">
                    <option value="">Select awards</option>
                    <option value="AF">Afghanistan</option>
                    <option value="AX">Åland Islands</option>
                    <option value="AL">Albania</option>
                </select>
            </div>
            <div class="ui button" id="send-title" type="submit">Submit</div>
        </form>
    </div>
</div>

</body>
</html>
